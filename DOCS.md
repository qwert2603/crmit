# Системные роли

Кроме системных ролей руководителя, преподавателя и ученика в CRM ЦМИТ также есть роли разработчика и бота.

## Системная роль "разработчик"

Текст.

## Системная роль "бот"

Эта роль предназначена для выполения автоматических операций. Например, создание дампа.

Бот не может авторизовываться на сайте или в мобильном приложении.

Бот имеет доступ только к тем страницам на сайте, которые отмечены декоратором `@check_bot_access_token_with_logins`.
В параметре этого декоратора указывается список логинов ботов, которые имеют доступ к указанной странице.

По задумке, в системе присустсвует только 1 бот с логином `dump_creator`, который делает дампы по расписанию.
Соответсвенно, есть только 1 метод с декоратором `@check_bot_access_token_with_logins`.
Это метод `dump` в [REST-API](https://github.com/qwert2603/crmit/blob/master/app/api_1_1_0/rests.py#L364).

# Создание дампа

Дамп создается с помощью скрипта [make_crmit_dump.py](https://github.com/qwert2603/crmit/blob/master/make_crmit_dump.py).

Необходимые параметры для создания дампа находятся в файле
[credentials.txt](https://github.com/qwert2603/crmit/blob/master/credentials.txt).

Список email получателей дампа указывается в переменной `mail_receivers` в скрипте `make_crmit_dump.py`.

Для получения `access_token` бота нужно выполнить REST-запрос авторизации, указав правильный пароль бота:

```
POST http://crm.cmit22.ru/api/v1.1.0/login
{
  "login": "dump_creator",
  "password": "the_password_of_bot",
  "device": "pc",
  "appVersion": "-1/12"
}
```

Для автоматического создания дапма по расписанию нужно настроить cron, указав путь к скрипту:
```
0 * * * * python3 /path/to/dir/make_crmit_dump.py
```
