{% extends 'base.html' %}
{% from '_macros.html' import pagination_widget %}
{% from '_macros.html' import render_search %}

{% block title %}список преподавателей{% endblock %}

{% block page_content %}
    {% if current_user.system_role.name == role_master_name %}
        <a href="{{ url_for('users.register_teacher') }}" class="btn btn-default">добавить преподавателя</a>
    {% endif %}

    {{ render_search(search) }}

    <table class="table">
        <tr>
            <th>фио</th>
            <th>логин</th>
            <th>группы</th>
            <th>телефон</th>
            <th>последний визит</th>
            {% if current_user.system_role.name == role_master_name %}
                <th></th>
                <th></th>
            {% endif %}
        </tr>
        {% for teacher in items %}
            <tr>
                <td>
                    {% if teacher.system_user.enabled %}
                        {{ teacher.fio }}
                    {% else %}
                        <strike>{{ teacher.fio }}</strike><br/>(отключен)
                    {% endif %}
                </td>
                <td>{{ teacher.system_user.login }}</td>
                <td>
                    <ul>
                        {% for group in teacher.groups.all() %}
                            <li>{{ group.name }}</li>
                        {% else %}
                            <p><i>нет групп</i></p>
                        {% endfor %}
                    </ul>
                </td>
                <td>{{ teacher.phone }}</td>
                <td>{{ moment(teacher.system_user.last_seen).fromNow(refresh=True) }}</td>
                {% if current_user.system_role.name == role_master_name %}
                    <td>
                        <a href="{{ url_for('users.edit_teacher',id=teacher.id) }}" class="btn btn-default">
                            <span class="glyphicon glyphicon-pencil"></span>
                        </a>
                    </td>
                    <td>
                        <a onclick="askDelete('{{ teacher.fio }}', '{{ url_for('users.delete_teacher',id=teacher.id) }}')"
                           class="btn btn-danger {% if not is_teacher_removable(teacher) %}disabled{% endif %}">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </td>
                {% endif %}
            </tr>
        {% else %}
            {% if search %}<p><i>ничего не найдено</i></p>{% endif %}
        {% endfor %}
    </table>

    <div class="footer">
        {{ pagination_widget(pagination, 'users.teachers_list') }}
    </div>
{% endblock %}